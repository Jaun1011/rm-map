<html lang="de">

<head>
    <title>fog of war</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<div id="app"></div>

</body>


<script lang="javascript">

    const element = name => document.createElementNS("http://www.w3.org/2000/svg", name);


    const lineElement = (p1, p2, color = "black") => {
        const l = element("line")

        l.setAttribute("x1", p1.x);
        l.setAttribute("y1", p1.y);
        l.setAttribute("x2", p2.x);
        l.setAttribute("y2", p2.y);
        l.setAttribute("stroke", color);

        return l;
    }


    const circleElement = p => {
        const e = element("circle");

        e.setAttribute("cx", p.x);
        e.setAttribute("cy", p.y);
        e.setAttribute("r", "2");


        return e;
    }


    const polyLineElement = (points) => {

 //       <polyline points="0,100 50,25 50,75 100,0" />

        const e = element("polyline");
        e.setAttribute("points", points.map(p => `${p.x},${p.y}`).reduce((a,b) => a +" " +b));

        return e;
    }


    const calcShadow = (root,p) => (line) => {


        const v1 = {
            x: line[0].x - p.x,
            y: line[0].y - p.y
        }

        const v2 = {
            x: line[1].x - p.x,
            y: line[1].y - p.y
        }

        const n = 100;

        const p1 = {
            x: v1.x * n,
            y: v1.y * n
        };

        const p2 = {
            x: v2.x * n,
            y: v2.y * n
        };

        root.appendChild(polyLineElement([
            p1,
            p2,
            line[1],
            line[0]
        ]));
    }


    const project = (root) => {

        const height = 500;
        const width = 500;
        const svg = element("svg")
        svg.setAttribute("viewBox", `-100 -100 ${height} ${width}`)


        const lines = [
            [
                {x: 300, y: 200},
                {x: 300, y: 30}
            ],

            [
                {x: 30, y: 200},
                {x: 300, y: 200}
            ],
        ]


        const chara = {x: 20, y: 20};


        lines.forEach(line => {
            svg.appendChild(lineElement(line[0], line[1], "red"))
        })

        const calcShadowWithSvg = calcShadow(svg,chara)
        lines.forEach(calcShadowWithSvg)

        svg.appendChild(circleElement(chara))
        root.appendChild(svg)
    }


    project(document.getElementById("app"))


</script>
</html>